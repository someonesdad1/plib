"""

Returns a dictionary cpi_data for the average US CPI (consumer price index) from 1913 to the present

    Gets the average CPI number from the table at the indicated website.  Note that the average calculated
    from the tables' entries for early years doesn't match the yearly average; still, I've chosen to use the
    table's average column (zero-based column 13) rather than compute the average.

    Each of the numbers in the table can be used to compare costs for the things we need to live over time.
    Let's compare the year 1967 to 2023.  The yearly average for 1967 is 33.4 and the yearly average for 2023
    is 305.  The ratio of these two numbers 305/33.4 = 9.1.  This tells me that something that cost me $1 in
    1967 would probably cost around $9 in 2023.

    Visit https://www.bls.gov/opub/hom/cpi/ to learn more about the CPI.  The US Bureau of Labor and
    Statistics collects about 94000 prices and 8000 rental housing unit quotes monthly and condenses the
    information into an estimate of what it costs to live in an urban environment.

"""

if 1:  # Header
    if 1:  # Copyright, license
        # These "trigger strings" can be managed with trigger.py
        # ∞copyright∞# Copyright (C) 2024 Don Peterson #∞copyright∞#
        # ∞contact∞# gmail.com@someonesdad1 #∞contact∞#
        # ∞license∞#
        #   Licensed under the Open Software License version 3.0.
        #   See http://opensource.org/licenses/OSL-3.0.
        # ∞license∞#
        # ∞what∞#
        # Returns a dictionary of the US consumer price index
        # ∞what∞#
        # ∞test∞# #∞test∞#
        pass
    if 1:  # Standard imports
        pass
    if 1:  # Custom imports
        from color import t
        from f import flt
        from columnize import Columnize

# From https://www.inflationdata.com/inflation/Consumer_Price_Index/HistoricalCPI.aspx?reloaded%3Dtrue#Table
#         Jan     Feb     Mar     Apr     May     Jun     Jul     Aug     Sep     Oct     Nov     Dec    Year
# Updated 25 Nov 2024
data = """
2024	308.417	310.326	312.332	313.548	314.069	314.175	314.540	314.796	315.301	315.664
2023	299.170	300.840	301.836	303.363	304.127	305.109	305.691	307.026	307.789	307.671	307.051	306.746	304.702
2022	281.148	283.716	287.504	289.109	292.296	296.311	296.276	296.171	296.808	298.012	297.711	296.797	292.655
2021	261.582	263.014	264.877	267.054	269.195	271.696	273.003	273.567	274.310	276.589	277.948	278.802	270.970
2020	257.971	258.678	258.115	256.389	256.394	257.797	259.101	259.918	260.280	260.388	260.229	260.474	258.811
2019	251.712	252.776	254.202	255.548	256.092	256.143	256.571	256.558	256.759	257.346	257.208	256.974	255.657
2018	247.867	248.991	249.554	250.546	251.588	251.989	252.006	252.146	252.439	252.885	252.038	251.233	251.107
2017	242.839	243.603	243.801	244.524	244.733	244.955	244.786	245.519	246.819	246.663	246.669	246.524	245.120
2016	236.916	237.111	238.132	239.261	240.229	241.018	240.628	240.849	241.428	241.729	241.353	241.432	240.008
2015	233.707	234.722	236.119	236.599	237.805	238.638	238.654	238.316	237.945	237.838	237.336	236.525	237.017
2014	233.916	234.781	236.293	237.072	237.900	238.343	238.250	237.852	238.031	237.433	236.151	234.812	236.736
2013	230.280	232.166	232.773	232.531	232.945	233.504	233.596	233.877	234.149	233.546	233.069	233.049	232.957
2012	226.665	227.663	229.392	230.085	229.815	229.478	229.104	230.379	231.407	231.317	230.221	229.601	229.594
2011	220.223	221.309	223.467	224.906	225.964	225.722	225.922	226.545	226.889	226.421	226.230	225.672	224.939
2010	216.687	216.741	217.631	218.009	218.178	217.965	218.011	218.312	218.439	218.711	218.803	219.179	218.056
2009	211.143	212.193	212.709	213.240	213.856	215.693	215.351	215.834	215.969	216.177	216.330	215.949	214.537
2008	211.080	211.693	213.528	214.823	216.632	218.815	219.964	219.086	218.783	216.573	212.425	210.228	215.303
2007	202.416	203.499	205.352	206.686	207.949	208.352	208.299	207.917	208.490	208.936	210.177	210.036	207.342
2006	198.300	198.700	199.800	201.500	202.500	202.900	203.500	203.900	202.900	201.800	201.500	201.800	201.600
2005	190.700	191.800	193.300	194.600	194.400	194.500	195.400	196.400	198.800	199.200	197.600	196.800	195.300
2004	185.200	186.200	187.400	188.000	189.100	189.700	189.400	189.500	189.900	190.900	191.000	190.300	188.900
2003	181.700	183.100	184.200	183.800	183.500	183.700	183.900	184.600	185.200	185.000	184.500	184.300	183.960
2002	177.100	177.800	178.800	179.800	179.800	179.900	180.100	180.700	181.000	181.300	181.300	180.900	179.880
2001	175.100	175.800	176.200	176.900	177.700	178.000	177.500	177.500	178.300	177.700	177.400	176.700	177.100
2000	168.800	169.800	171.200	171.300	171.500	172.400	172.800	172.800	173.700	174.000	174.100	174.000	172.200
1999	164.300	164.500	165.000	166.200	166.200	166.200	166.700	167.100	167.900	168.200	168.300	168.300	166.600
1998	161.600	161.900	162.200	162.500	162.800	163.000	163.200	163.400	163.600	164.000	164.000	163.900	163.000
1997	159.100	159.600	160.000	160.200	160.100	160.300	160.500	160.800	161.200	161.600	161.500	161.300	160.500
1996	154.400	154.900	155.700	156.300	156.600	156.700	157.000	157.300	157.800	158.300	158.600	158.600	156.900
1995	150.300	150.900	151.400	151.900	152.200	152.500	152.500	152.900	153.200	153.700	153.600	153.500	152.400
1994	146.200	146.700	147.200	147.400	147.500	148.000	148.400	149.000	149.400	149.500	149.700	149.700	148.200
1993	142.600	143.100	143.600	144.000	144.200	144.400	144.400	144.800	145.100	145.700	145.800	145.800	144.500
1992	138.100	138.600	139.300	139.500	139.700	140.200	140.500	140.900	141.300	141.800	142.000	141.900	140.300
1991	134.600	134.800	135.000	135.200	135.600	136.000	136.200	136.600	137.200	137.400	137.800	137.900	136.200
1990	127.400	128.000	128.700	128.900	129.200	129.900	130.400	131.600	132.700	133.500	133.800	133.800	130.700
1989	121.100	121.600	122.300	123.100	123.800	124.100	124.400	124.600	125.000	125.600	125.900	126.100	124.000
1988	115.700	116.000	116.500	117.100	117.500	118.000	118.500	119.000	119.800	120.200	120.300	120.500	118.300
1987	111.200	111.600	112.100	112.700	113.100	113.500	113.800	114.400	115.000	115.300	115.400	115.400	113.600
1986	109.600	109.300	108.800	108.600	108.900	109.500	109.500	109.700	110.200	110.300	110.400	110.500	109.600
1985	105.500	106.000	106.400	106.900	107.300	107.600	107.800	108.000	108.300	108.700	109.000	109.300	107.600
1984	101.900	102.400	102.600	103.100	103.400	103.700	104.100	104.500	105.000	105.300	105.300	105.300	103.900
1983	97.800	97.900	97.900	98.600	99.200	99.500	99.900	100.200	100.700	101.000	101.200	101.300	99.600
1982	94.300	94.600	94.500	94.900	95.800	97.000	97.500	97.700	97.900	98.200	98.000	97.600	96.500
1981	87.000	87.900	88.500	89.100	89.800	90.600	91.600	92.300	93.200	93.400	93.700	94.000	90.900
1980	77.800	78.900	80.100	81.000	81.800	82.700	82.700	83.300	84.000	84.800	85.500	86.300	82.400
1979	68.300	69.100	69.800	70.600	71.500	72.300	73.100	73.800	74.600	75.200	75.900	76.700	72.600
1978	62.500	62.900	63.400	63.900	64.500	65.200	65.700	66.000	66.500	67.100	67.400	67.700	65.200
1977	58.500	59.100	59.500	60.000	60.300	60.700	61.000	61.200	61.400	61.600	61.900	62.100	60.600
1976	55.600	55.800	55.900	56.100	56.500	56.800	57.100	57.400	57.600	57.900	58.000	58.200	56.900
1975	52.100	52.500	52.700	52.900	53.200	53.600	54.200	54.300	54.600	54.900	55.300	55.500	53.800
1974	46.600	47.200	47.800	48.000	48.600	49.000	49.400	50.000	50.600	51.100	51.500	51.900	49.300
1973	42.600	42.900	43.300	43.600	43.900	44.200	44.300	45.100	45.200	45.600	45.900	46.200	44.400
1972	41.100	41.300	41.400	41.500	41.600	41.700	41.900	42.000	42.100	42.300	42.400	42.500	41.800
1971	39.800	39.900	40.000	40.100	40.300	40.600	40.700	40.800	40.800	40.900	40.900	41.100	40.500
1970	37.800	38.000	38.200	38.500	38.600	38.800	39.000	39.000	39.200	39.400	39.600	39.800	38.800
1969	35.600	35.800	36.100	36.300	36.400	36.600	36.800	37.000	37.100	37.300	37.500	37.700	36.700
1968	34.100	34.200	34.300	34.400	34.500	34.700	34.900	35.000	35.100	35.300	35.400	35.500	34.800
1967	32.900	32.900	33.000	33.100	33.200	33.300	33.400	33.500	33.600	33.700	33.800	33.900	33.400
1966	31.800	32.000	32.100	32.300	32.300	32.400	32.500	32.700	32.700	32.900	32.900	32.900	32.400
1965	31.200	31.200	31.300	31.400	31.400	31.600	31.600	31.600	31.600	31.700	31.700	31.800	31.500
1964	30.900	30.900	30.900	30.900	30.900	31.000	31.100	31.000	31.100	31.100	31.200	31.200	31.000
1963	30.400	30.400	30.500	30.500	30.500	30.600	30.700	30.700	30.700	30.800	30.800	30.900	30.600
1962	30.000	30.100	30.100	30.200	30.200	30.200	30.300	30.300	30.400	30.400	30.400	30.400	30.200
1961	29.800	29.800	29.800	29.800	29.800	29.800	30.000	29.900	30.000	30.000	30.000	30.000	29.900
1960	29.300	29.400	29.400	29.500	29.500	29.600	29.600	29.600	29.600	29.800	29.800	29.800	29.600
1959	29.000	28.900	28.900	29.000	29.000	29.100	29.200	29.200	29.300	29.400	29.400	29.400	29.100
1958	28.600	28.600	28.800	28.900	28.900	28.900	29.000	28.900	28.900	28.900	29.000	28.900	28.900
1957	27.600	27.700	27.800	27.900	28.000	28.100	28.300	28.300	28.300	28.300	28.400	28.400	28.100
1956	26.800	26.800	26.800	26.900	27.000	27.200	27.400	27.300	27.400	27.500	27.500	27.600	27.200
1955	26.700	26.700	26.700	26.700	26.700	26.700	26.800	26.800	26.900	26.900	26.900	26.800	26.800
1954	26.900	26.900	26.900	26.800	26.900	26.900	26.900	26.900	26.800	26.800	26.800	26.700	26.900
1953	26.600	26.500	26.600	26.600	26.700	26.800	26.800	26.900	26.900	27.000	26.900	26.900	26.700
1952	26.500	26.300	26.300	26.400	26.400	26.500	26.700	26.700	26.700	26.700	26.700	26.700	26.500
1951	25.400	25.700	25.800	25.800	25.900	25.900	25.900	25.900	26.100	26.200	26.400	26.500	26.000
1950	23.500	23.500	23.600	23.600	23.700	23.800	24.100	24.300	24.400	24.600	24.700	25.000	24.100
1949	24.000	23.800	23.800	23.900	23.800	23.900	23.700	23.800	23.900	23.700	23.800	23.600	23.800
1948	23.700	23.500	23.400	23.800	23.900	24.100	24.400	24.500	24.500	24.400	24.200	24.100	24.100
1947	21.500	21.500	21.900	21.900	21.900	22.000	22.200	22.500	23.000	23.000	23.100	23.400	22.300
1946	18.200	18.100	18.300	18.400	18.500	18.700	19.800	20.200	20.400	20.800	21.300	21.500	19.500
1945	17.800	17.800	17.800	17.800	17.900	18.100	18.100	18.100	18.100	18.100	18.100	18.200	18.000
1944	17.400	17.400	17.400	17.500	17.500	17.600	17.700	17.700	17.700	17.700	17.700	17.800	17.600
1943	16.900	16.900	17.200	17.400	17.500	17.500	17.400	17.300	17.400	17.400	17.400	17.400	17.300
1942	15.700	15.800	16.000	16.100	16.300	16.300	16.400	16.500	16.500	16.700	16.800	16.900	16.300
1941	14.100	14.100	14.200	14.300	14.400	14.700	14.700	14.900	15.100	15.300	15.400	15.500	14.700
1940	13.900	14.000	14.000	14.000	14.000	14.100	14.000	14.000	14.000	14.000	14.000	14.100	14.000
1939	14.000	13.900	13.900	13.800	13.800	13.800	13.800	13.800	14.100	14.000	14.000	14.000	13.900
1938	14.200	14.100	14.100	14.200	14.100	14.100	14.100	14.100	14.100	14.000	14.000	14.000	14.100
1937	14.100	14.100	14.200	14.300	14.400	14.400	14.500	14.500	14.600	14.600	14.500	14.400	14.400
1936	13.800	13.800	13.700	13.700	13.700	13.800	13.900	14.000	14.000	14.000	14.000	14.000	13.900
1935	13.600	13.700	13.700	13.800	13.800	13.700	13.700	13.700	13.700	13.700	13.800	13.800	13.700
1934	13.200	13.300	13.300	13.300	13.300	13.400	13.400	13.400	13.600	13.500	13.500	13.400	13.400
1933	12.900	12.700	12.600	12.600	12.600	12.700	13.100	13.200	13.200	13.200	13.200	13.200	13.000
1932	14.300	14.100	14.000	13.900	13.700	13.600	13.600	13.500	13.400	13.300	13.200	13.100	13.700
1931	15.900	15.700	15.600	15.500	15.300	15.100	15.100	15.100	15.000	14.900	14.700	14.600	15.200
1930	17.100	17.000	16.900	17.000	16.900	16.800	16.600	16.500	16.600	16.500	16.400	16.100	16.700
1929	17.100	17.100	17.000	16.900	17.000	17.100	17.300	17.300	17.300	17.300	17.300	17.200	17.100
1928	17.300	17.100	17.100	17.100	17.200	17.100	17.100	17.100	17.300	17.200	17.200	17.100	17.100
1927	17.500	17.400	17.300	17.300	17.400	17.600	17.300	17.200	17.300	17.400	17.300	17.300	17.400
1926	17.900	17.900	17.800	17.900	17.800	17.700	17.500	17.400	17.500	17.600	17.700	17.700	17.700
1925	17.300	17.200	17.300	17.200	17.300	17.500	17.700	17.700	17.700	17.700	18.000	17.900	17.500
1924	17.300	17.200	17.100	17.000	17.000	17.000	17.100	17.000	17.100	17.200	17.200	17.300	17.100
1923	16.800	16.800	16.800	16.900	16.900	17.000	17.200	17.100	17.200	17.300	17.300	17.300	17.100
1922	16.900	16.900	16.700	16.700	16.700	16.700	16.800	16.600	16.600	16.700	16.800	16.900	16.800
1921	19.000	18.400	18.300	18.100	17.700	17.600	17.700	17.700	17.500	17.500	17.400	17.300	17.900
1920	19.300	19.500	19.700	20.300	20.600	20.900	20.800	20.300	20.000	19.900	19.800	19.400	20.000
1919	16.500	16.200	16.400	16.700	16.900	16.900	17.400	17.700	17.800	18.100	18.500	18.900	17.300
1918	14.000	14.100	14.000	14.200	14.500	14.700	15.100	15.400	15.700	16.000	16.300	16.500	15.100
1917	11.700	12.000	12.000	12.600	12.800	13.000	12.800	13.000	13.300	13.500	13.500	13.700	12.800
1916	10.400	10.400	10.500	10.600	10.700	10.800	10.800	10.900	11.100	11.300	11.500	11.600	10.900
1915	10.100	10.000	9.900	10.000	10.100	10.100	10.100	10.100	10.100	10.200	10.300	10.300	10.100
1914	10.000	9.900	9.900	9.800	9.900	9.900	10.000	10.200	10.200	10.100	10.200	10.100	10.000
1913	9.800	9.800	9.800	9.800	9.700	9.800	9.900	9.900	10.000	10.000	10.100	10.000	9.900
"""


def CPI_Data(use_partial=True, show=False):
    """Return a dictionary that maps integer year to average inflation for the year.  If use_partial is True,
    then calculate the mean of the given data even if a line only has a partial number of entries.  Otherwise,
    use the last entry on the line if the line has 14 fields.  If show is True, print the data to stdout.
    """
    out, t.bad = [], t("ornl")
    for i, line in enumerate(data.split("\n")):
        if not line.strip():
            continue
        f = line.split("\t")
        yr = int(f[0])
        if len(f) == 14:
            cpi = flt(f[-1])
        else:
            if not use_partial:
                t.print(f"{t.bad}Line {i + 1} is a bad line in the data:")
                s = line.replace("\t", " ")
                t.print(f"{t.bad}  {s!r}")
                t.print(f"{t('yell')}  It does not have 14 fields")
                raise ValueError(f"Bad line {i + 1}")
            # The cpi will be the mean of the given values
            cpi = sum([flt(k) for k in f[1:]]) / len(f[1:])
        out.append((yr, cpi))
    # Set up floating point resolution
    x = flt(0)
    x.N = 4
    # Construct dictionary
    di = {}
    for yr, cpi in out:
        di[yr] = cpi
    if show:
        s = []
        for yr, cpi in out:
            s.append(f"{yr}: {cpi}")
        for i in Columnize(s):
            print(i)
    return di


cpi_data = CPI_Data(show=False)

if __name__ == "__main__":
    import sys
    import statistics

    def ShowYearlyRatio():
        "Print a table that shows the yearly ratio"
        out = []
        for i in cpi_data:
            out.append((i, cpi_data[i]))
        last = None
        x = flt(0)
        x.N = 2
        t.plus = t("wht")
        t.zero = t("purl")
        t.minus = t("lip")
        results = []
        st = []
        start = 1913
        for i, item in enumerate(out):
            yr, cpi = item
            if not i:
                last = cpi
                continue
            elif yr < start:
                last = cpi
                continue
            else:
                pctchg = round(100 * flt(1 - cpi / last), 1)
                st.append(pctchg)
                c = t.zero
                if pctchg > 0:
                    c = t.plus
                elif pctchg < 0:
                    c = t.minus
                results.append(f"{c}{yr:4d} {pctchg:-5.1f}{t.n}")
                last = cpi
        print("% change yearly in consumer price index")
        for i in Columnize(results, sep=" " * 3):
            print(i)
        mean = flt(statistics.mean(st))
        median = flt(statistics.median(st))
        s = flt(statistics.stdev(st))
        q = [flt(i) for i in statistics.quantiles(st)]
        Q = ", ".join(str(i) for i in q)
        print(f"Statistics over {len(st)} years in %/yr:")
        print(f"  Mean                  {mean}")
        print(f"  Median                {median}")
        print(f"  Standard deviation    {s}")
        print(f"  Quantiles             {Q}")
        print(f"  Minimum               {min(st)}")
        print(f"  Maximum               {max(st)}")
        print(f"  Range                 {max(st) - min(st)}")

    ShowYearlyRatio()
